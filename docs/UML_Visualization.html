<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Career Coach - UML Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default', securityLevel: 'loose' });
    </script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
            background-color: #f4f6f8;
            color: #333;
        }

        .diagram-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 50px;
            border: 1px solid #e1e4e8;
            position: relative;
        }

        h1 {
            text-align: center;
            color: #1a1a1a;
            margin-bottom: 40px;
            font-size: 2.5rem;
        }

        h2 {
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
            margin-bottom: 20px;
            color: #2d3748;
            font-size: 1.5rem;
        }

        .mermaid {
            text-align: center;
            overflow-x: auto;
            padding: 20px 0;
        }

        .instructions {
            background: #e6fffa;
            color: #2c7a7b;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 40px;
            border: 1px solid #b2f5ea;
        }

        .download-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            display: inline-block;
            transition: background 0.2s;
        }

        .download-btn:hover {
            background-color: #0056b3;
        }

        .btn-container {
            text-align: right;
            border-top: 1px solid #eee;
            padding-top: 10px;
            margin-top: 10px;
        }
    </style>
</head>

<body>

    <h1>AI Career Coach - UML Diagrams</h1>

    <div class="instructions">
        <strong>âœ¨ New Feature:</strong> Download buttons added below each diagram!
        <br>Click "Download PNG" to save high-quality images directly to your computer.
    </div>

    <!-- 1. Use Case Diagram -->
    <div class="diagram-card">
        <h2>1. Use Case Diagram</h2>
        <div class="mermaid" id="diag-1">
            graph TD
            User((Job Seeker))
            AI((Google Gemini API))
            Auth((Clerk Auth))

            subgraph System ["AI Career Coach System"]
            UC1([Login / Register])
            UC2([Onboarding])
            UC3([Dashboard / Industry Insights])
            UC4([Create AI Resume])
            UC5([Generate Cover Letter])
            UC6([Mock Interview Session])

            UC7([View Feedback & Scores])
            UC8([Download Documents])
            UC9([Select Resume Context])
            end

            %% Actor Intractions
            User --> UC1
            User --> UC2
            User --> UC3
            User --> UC4
            User --> UC5
            User --> UC6

            %% Advanced Relationships (Mimicking Sample)
            UC6 -.->|&lt;&lt;extends&gt;&gt;| UC7
            UC3 -.->|&lt;&lt;extends&gt;&gt;| UC7
            UC5 -.->|&lt;&lt;includes&gt;&gt;| UC9
            UC4 -.->|&lt;&lt;includes&gt;&gt;| UC8
            UC5 -.->|&lt;&lt;includes&gt;&gt;| UC8

            %% System Dependencies
            UC1 -.-> Auth
            UC3 -.-> AI
            UC4 -.-> AI
            UC5 -.-> AI
            UC6 -.-> AI
        </div>
        <div class="btn-container">
            <button class="download-btn" onclick="downloadSVG('diag-1', 'UseCase_Diagram.png')">Download PNG</button>
        </div>
    </div>

    <!-- 2. Activity Diagram -->
    <div class="diagram-card">
        <h2>2. Activity Diagram (Comprehensive System Flow)</h2>
        <div class="mermaid" id="diag-2">
            flowchart TD
            start([Start]) --> Login[User Logs In]
            Login --> Auth{Authenticated?}
            Auth -- No --> SignUp[Sign Up / Login via Clerk]
            SignUp --> Onboard[Onboarding: Industry & Skills]
            Onboard --> ProfileSetup[Profile Setup & Review]
            Auth -- Yes --> Dash[Dashboard: Industry Insights<br />Trending Tech & Skills]
            ProfileSetup --> Dash

            Dash --> Choice{Select Feature}

            %% Resume Path
            Choice -- Resume Builder --> ResForm[Enter Details / Upload]
            ResForm --> ResAI[Request AI Optimization]
            ResAI --> CheckRes[Review Markdown Resume]
            CheckRes --> SaveRes[Save Resume]

            %% Cover Letter Path
            Choice -- Cover Letter --> SelRes[Select Resume]
            SelRes --> PasteJD[Paste Job Description]
            PasteJD --> GenCL[Generate Cover Letter]
            GenCL --> EditCL[Edit & Refine]
            EditCL --> SaveCL[Save Cover Letter]

            %% Interview Path
            Choice -- Mock Interview --> ConfigInt[Select Topic & Difficulty]
            ConfigInt --> StartInt[Start Session]
            StartInt --> QLoop{Question Loop}
            QLoop -- Ask --> GenQ[AI Generates Question]
            GenQ --> UserAns[User Answers]
            UserAns --> Analy[AI Analyzes & Rates]
            Analy --> QLoop
            QLoop -- End --> Summ[View Feedback Summary]

            SaveRes --> Dash
            SaveCL --> Dash
            Summ --> Dash
        </div>
        <div class="btn-container">
            <button class="download-btn" onclick="downloadSVG('diag-2', 'Activity_Diagram.png')">Download PNG</button>
        </div>
    </div>

    <!-- 3. Sequence Diagram -->
    <div class="diagram-card">
        <h2>3. Sequence Diagram (Content Generation Flow)</h2>
        <div class="mermaid" id="diag-3">
            sequenceDiagram
            participant U as User
            participant FE as Frontend (Next.js)
            participant BE as Backend (Server Actions)
            participant DB as Neon DB (Prisma)
            participant AI as Google Gemini API

            note over U, FE: User initiates generation

            U->>FE: Click "Industry Insights/Skill Recommendation"
            U->>FE: Click "Generate Resume/Cover Letter"
            U->>FE: Click "Mock Interview Prep"
            FE->>BE: POST request (User Data + Prompt)
            BE->>DB: Fetch User Context / Profile
            DB-->>BE: Return Profile Data

            BE->>AI: Send Prompt (Profile + Requirements)
            activate AI
            AI-->>BE: Return Generated Content
            deactivate AI

            BE->>FE: Return Markdown Response
            FE->>U: Display Preview

            U->>FE: Click "Save to Dashboard"
            FE->>BE: Save Action
            BE->>DB: Insert into DB
            DB-->>BE: Confirmation
            BE-->>FE: Success Toast
        </div>
        <div class="btn-container">
            <button class="download-btn" onclick="downloadSVG('diag-3', 'Sequence_Diagram.png')">Download PNG</button>
        </div>
    </div>

    <!-- 4. Class Diagram -->
    <div class="diagram-card">
        <h2>4. Class Diagram (Expanded)</h2>
        <div class="mermaid" id="diag-4">
            classDiagram
            class User {
            +String id
            +String clerkId
            +String industry
            +Int experienceYears
            +List~Resume~ resumes
            +List~CoverLetter~ coverLetters
            +List~MockInterview~ interviews
            }

            class Resume {
            +String id
            +String title
            +String contentMarkdown
            +String atsScore
            }

            class CoverLetter {
            +String id
            +String jobDescription
            +String generatedText
            }

            class MockInterview {
            +String id
            +String industry
            +Int overallScore
            +List~InterviewQuestion~ questions
            }

            class InterviewQuestion {
            +String question
            +String userAnswer
            +String feedback
            +Int score
            }

            class IndustryInsight {
            +String id
            +String industry
            +List~String~ trendingSkills
            +List~String~ salaryRange
            }

            class Database_Neon {
            +saveUser()
            +saveResume()
            +saveInterview()
            }

            class Gemini_API {
            +generateResume()
            +generateCoverLetter()
            +generateQuestion()
            +analyzeAnswer()
            }

            User "1" --> "*" Resume
            User "1" --> "*" CoverLetter
            User "1" --> "*" MockInterview
            MockInterview "1" --> "*" InterviewQuestion
            User ..> IndustryInsight : views
            User ..> Gemini_API : uses via Backend
            User ..> Database_Neon : stores data
        </div>
        <div class="btn-container">
            <button class="download-btn" onclick="downloadSVG('diag-4', 'Class_Diagram.png')">Download PNG</button>
        </div>
    </div>

    <!-- 5. Flowchart Diagram -->
    <div class="diagram-card">
        <h2>5. Flowchart Diagram (System Navigation)</h2>
        <div class="mermaid" id="diag-5">
            graph TD
            A[Landing Page] -->|Click Get Started| B{Is Authenticated?}
            B -- No --> C[Clerk Login/Signup]
            C --> B
            B -- Yes --> D{Is Onboarded?}
            D -- No --> E[Onboarding Form]
            E --> F[Profile Setup]
            F --> F2[Save to DB]
            F2 --> G[Dashboard: Industry Insights]
            D -- Yes --> G

            G --> H[Resume Builder]
            G --> I[Cover Letter Gen]
            G --> J[Mock Interview]

            H --> K[View/Edit Resume]
            I --> L[View/Edit Letter]
            J --> M[Interview Session]
            M --> N[Results & Feedback]
            N --> G
        </div>
        <div class="btn-container">
            <button class="download-btn" onclick="downloadSVG('diag-5', 'Flowchart_Diagram.png')">Download PNG</button>
        </div>
    </div>

    <!-- 6. Deployment Diagram -->
    <div class="diagram-card">
        <h2>6. Deployment Diagram</h2>
        <div class="mermaid" id="diag-6">
            graph TB
            subgraph Client ["Client Side"]
            Browser[User Browser]
            end

            subgraph Server ["Server Side (Vercel)"]
            NextJS[Next.js App Router]
            API[API Routes]
            end

            subgraph External ["Cloud Infrastructure"]
            Neon[(Neon DB Postgres)]
            Gemini[Google Gemini API]
            Clerk[Clerk Auth]
            end

            Browser -->|HTTPS| NextJS
            NextJS -->|Internal Call| API
            API -->|TCP/Prisma| Neon
            API -->|REST/JSON| Gemini
            Browser -->|JWT| Clerk
        </div>
        <div class="btn-container">
            <button class="download-btn" onclick="downloadSVG('diag-6', 'Deployment_Diagram.png')">Download PNG</button>
        </div>
    </div>

    <script>
        function downloadSVG(containerId, filename) {
            const container = document.getElementById(containerId);
            const svg = container.querySelector('svg');

            if (!svg) {
                alert("Diagram not ready yet or syntax error. Please wait.");
                return;
            }

            // Get true SVG dimensions from viewBox (prevents cropping/zooming)
            let width, height;
            if (svg.hasAttribute('viewBox')) {
                const viewBox = svg.getAttribute('viewBox').split(/\s+|,/);
                width = parseFloat(viewBox[2]);
                height = parseFloat(viewBox[3]);
            } else {
                // Fallback if no viewBox
                const exactRect = svg.getBoundingClientRect();
                width = exactRect.width;
                height = exactRect.height;
            }

            // Get SVG data
            const serializer = new XMLSerializer();
            let source = serializer.serializeToString(svg);

            // Add namespaces if missing
            if (!source.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)) {
                source = source.replace(/^<svg/, '<svg xmlns="http://www.w3.org/2000/svg"');
            }
            if (!source.match(/^<svg[^>]+xmlns:xlink="http\:\/\/www\.w3\.org\/1999\/xlink"/)) {
                source = source.replace(/^<svg/, '<svg xmlns:xlink="http://www.w3.org/1999/xlink"');
            }

            // Add width/height to source explicitly if missing to ensure image loads correctly
            if (!source.match(/^<svg[^>]+width="/)) {
                source = source.replace(/^<svg/, `<svg width="${width}" height="${height}"`);
            }

            const img = new Image();
            img.src = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(source);

            img.onload = function () {
                const canvas = document.createElement('canvas');
                // High scale for crisp text
                const scale = 3;
                canvas.width = width * scale;
                canvas.height = height * scale;

                const ctx = canvas.getContext('2d');
                ctx.fillStyle = "white";
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Draw image scaling it clearly to the canvas size
                ctx.drawImage(img, 0, 0, width * scale, height * scale);

                const imgUrl = canvas.toDataURL("image/png");

                const link = document.createElement('a');
                link.href = imgUrl;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            img.onerror = function () {
                alert("Error generating image. Please try using a different browser.");
            };
        }
    </script>
</body>

</html>